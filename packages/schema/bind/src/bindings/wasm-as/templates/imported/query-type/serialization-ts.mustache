{{#methods.length}}
{{#methods}}
{{#arguments}}
{{#object}}
import { {{type}} } from "../../{{type}}";
{{/object}}
{{/arguments}}
{{/methods}}
import {
  Nullable,
  Write,
  WriteSizer,
  WriteEncoder,
  ReadDecoder
} from "@web3api/wasm-as";

{{#methods}}
export function serialize{{name}}Args(input: {
  {{#arguments}}
  {{name}}: {{#toWasm}}{{type}}{{/toWasm}}{{^last}},{{/last}}
  {{/arguments}}
}): ArrayBuffer {
  const sizer = new WriteSizer();
  write{{name}}Args(sizer, input);
  const buffer = new ArrayBuffer(sizer.length);
  const encoder = new WriteEncoder(buffer);
  write{{name}}Args(encoder, input);
  return buffer;
}

function write{{name}}Args(
  writer: Write,
  input: {
    {{#arguments}}
    {{name}}: {{#toWasm}}{{type}}{{/toWasm}}{{^last}},{{/last}}
    {{/arguments}}
  }
) {
  writer.writeMapLength({{arguments.length}});
  {{#arguments}}
  writer.writeString("{{name}}");
  {{#scalar}}
  writer.write{{#toMsgPack}}{{type}}{{/toMsgPack}}(input.{{name}});
  {{/scalar}}
  {{#array}}
  writer.write{{#toMsgPack}}{{type}}{{/toMsgPack}}(input.{{name}}, (writer: Write, item: {{#toWasm}}{{item.type}}{{/toWasm}}): void => {
    {{> serialize_array}}
  });
  {{/array}}
  {{#object}}
  writer.writeBytes(input.{{name}}.toBuffer());
  {{/object}}
  {{/arguments}}
}

export function deserialize{{name}}Result(buffer: ArrayBuffer): {{#toWasm}}{{return.type}}{{/toWasm}} {
  {{#return}}
  {{#scalar}}
  const reader = new ReadDecoder(buffer);
  return reader.read{{#toMsgPack}}{{type}}{{/toMsgPack}}();
  {{/scalar}}
  {{#array}}
  const reader = new ReadDecoder(buffer);
  return reader.read{{#toMsgPack}}{{type}}{{/toMsgPack}}((reader: Read): {{#toWasm}}{{item.type}}{{/toWasm}} => {
    {{> deserialize_array}}
  });
  {{/array}}
  {{#object}}
  const object = new {{type}}();
  object.fromBuffer(buffer);
  return object;
  {{/object}}
  {{/return}}
}
{{^last}}

{{/last}}
{{/methods}}
{{/methods.length}}
